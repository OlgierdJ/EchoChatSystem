@using CoreLib.DTO.EchoCore.UserCore
@using CoreLib.Entities.EchoCore.AccountCore
@*
    Layout for the Scrollable list that exists within the FriendsViewComponent in the pending section.

    This component holds all requests and allows the user to search within the requests to filter them.

    Clicking a request should open the profile of the other user.
*@
<MudPaper Square Height="5vh" Class="px-3 mb-6" Elevation="0">
     <MudTextField Placeholder=" Search" @bind-Value="searchTerm"
                   @onkeyup="(()=>SearchChanged())" Immediate/>
 </MudPaper>
 <MudText Class="px-5 py-2" Typo="Typo.button">Pending - @friendRequests.Count()</MudText>
    <MudList Clickable="true">
        @foreach (var r in filtered.OrderBy(x => x.Person.DisplayName))
    {
        <MudDivider />
        <MudListItem Dense="true" Class="mb-3 mt-2">
            <FriendRequestComponent Request="r" />
        </MudListItem>
    }
</MudList>
@code {
    public string searchTerm { get; set; } = "";

    public List<FriendRequestDTO> filtered;


    // DUMMY DATA
    public List<FriendRequestDTO> friendRequests = new()
    {
        new FriendRequestDTO()
        {
            Person = new UserDTO
            {
                Id = 114,
                DisplayName = "Benny 21",
                Name = "benny21g",
                ImageIconURL = "https://static.wikia.nocookie.net/marvelcinematicuniverse/images/3/35/IronMan-EndgameProfile.jpg"
            },
            Type = CoreLib.Entities.Enums.RequestType.Outgoing
        }, //outgoing
        new FriendRequestDTO()
        {
            Person = new UserDTO
            {
                Id = 115,
                DisplayName = "Billie Jeans @ click-here.xyz",
                Name = "clickhere123145856w",
                ImageIconURL = "https://helios-i.mashable.com/imagery/articles/02R4UBVAJlHadovaNQfVpyG/images-1.fill.size_2000x1124.v1611703273.jpg"
            },
            Type = CoreLib.Entities.Enums.RequestType.Incoming
        }, //incoming
        new FriendRequestDTO()
        {
            Person = new UserDTO
            {
                Id = 116,
                DisplayName = "Billie Jeans @ click-here.xyz",
                Name = "clickhere123145857n",
                ImageIconURL = "https://helios-i.mashable.com/imagery/articles/02R4UBVAJlHadovaNQfVpyG/images-1.fill.size_2000x1124.v1611703273.jpg"
            },
            Type = CoreLib.Entities.Enums.RequestType.Incoming
        }, //incoming
    };

   
    public FriendRequestListComponent()
    {
        filtered = friendRequests;
    }

    void SearchChanged()
    {
        Console.WriteLine(searchTerm);
        filtered = friendRequests.Where(e => e.Person.DisplayName.ToLower().Contains(searchTerm.ToLower())).ToList();
        StateHasChanged();
    }
}

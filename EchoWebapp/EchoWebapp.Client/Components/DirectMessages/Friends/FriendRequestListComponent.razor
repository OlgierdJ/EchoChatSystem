@using CoreLib.Entities.EchoCore.AccountCore
@*
    Layout for the Scrollable list that exists within the FriendsViewComponent in the pending section.

    This component holds all requests and allows the user to search within the requests to filter them.

    Clicking a request should open the profile of the other user.
*@
<MudPaper Square Height="5vh" Class="px-3 mb-6" Elevation="0">
     <MudTextField Placeholder=" Search" @bind-Value="searchTerm"
                   @onkeyup="(()=>SearchChanged())" Immediate/>
 </MudPaper>
 <MudText Class="px-5 py-2" Typo="Typo.button">Pending - @accounts.Count()</MudText>
    <MudList Clickable="true">
        @foreach (var c in filtered.OrderBy(x => x.Name))
    {
        <MudDivider />
        <MudListItem Dense="true" Class="mb-3 mt-2">
            <FriendRequestComponent Account="c" />
        </MudListItem>
    }
</MudList>
@code {
    public string searchTerm { get; set; } = "";
    public List<Account> filtered;

    //DUMMY DATA
    public List<Account> accounts = new List<Account>()
                        {
                new Account()
    {
        Id = 112, Name = "TheDoe", Profile = new AccountProfile() { AvatarFileURL = "https://us.tonies.com/cdn/shop/products/Tonies-PDP-Assets-Nemo-Single.jpg", },
                    ActivityStatus = new AccountActivityStatus()
                        {
                            Description = "Online",
                            Icon = "",
                            IconColor = Color.Success.ToString()
                        }, TimeCreated = DateTime.Now.AddDays(-17) },
                new Account() { Id = 113, Name = "BobTheBuilder", Profile = new AccountProfile() { AvatarFileURL = "https://a1cf74336522e87f135f-2f21ace9a6cf0052456644b80fa06d4f.ssl.cf2.rackcdn.com/images/characters/large/800/Shrek.Shrek.webp", } },
                new Account() { Id = 114, Name = "Mary Jane", Profile = new AccountProfile() { AvatarFileURL = "https://static.wikia.nocookie.net/marvelcinematicuniverse/images/3/35/IronMan-EndgameProfile.jpg", } },
                new Account() { Id = 115, Name = "Billie Jean",  Profile = new AccountProfile() { AvatarFileURL = "https://helios-i.mashable.com/imagery/articles/02R4UBVAJlHadovaNQfVpyG/images-1.fill.size_2000x1124.v1611703273.jpg", } },
                new Account() { Id = 116, Name = "Jeppe", Profile = new AccountProfile() { AvatarFileURL = "https://www.looper.com/img/gallery/the-ending-of-death-note-explained/intro-1620395655.jpg", } }
    };
    public FriendRequestListComponent()
    {

        filtered  = accounts;
    }

    void SearchChanged()
    {
        Console.WriteLine(searchTerm);
        filtered = accounts.Where(e => e.Name.ToLower().Contains(searchTerm.ToLower())).ToList();
        StateHasChanged();
    }
}
